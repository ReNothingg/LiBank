<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <title>LiBank — Аккаунт</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="stylesheet" href="/static/css/style.css">
    <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>

<body data-page="account">
    <div class="app-gradient"></div>
    <div class="safe-area">

        <header class="topbar">
            <div class="brand">LiBank</div>
            <div class="topbar-actions">
                <button class="btn-icon" aria-label="Профиль" title="Профиль"
                    onclick="location.href='/profile'">⚙️</button>
                <button id="logoutBtn" class="btn-icon" aria-label="Выход" title="Выйти">⎋</button>
            </div>
        </header>

        <main class="content">
            <section class="balance card ios-card animate-rise">
                <div class="balance-label">Баланс</div>
                <div id="balanceValue" class="balance-value">—</div>
                <div id="fullNameLabel" class="balance-fullname">—</div>
                <div id="usernameLabel" class="balance-sub">—</div>
            </section>

            <section class="actions actions-icons" aria-label="Действия">
                <div class="action-tile">
                    <button id="transferBtn" class="btn-icon action-btn" aria-label="Перевести">
                        <img src="/static/icons/transfer.svg" width="22" height="22" alt="" aria-hidden="true" />
                    </button>
                    <div class="action-label">Перевести</div>
                </div>

                <div class="action-tile">
                    <button id="scanBtn" class="btn-icon action-btn" aria-label="Сканировать QR">
                        <img src="/static/icons/scan.svg" width="22" height="22" alt="" aria-hidden="true" />
                    </button>
                    <div class="action-label">Сканировать QR</div>
                </div>

                <div class="action-tile">
                    <button id="createInvoiceBtn" class="btn-icon action-btn" aria-label="Создать QR">
                        <img src="/static/icons/invoice.svg" width="22" height="22" alt="" aria-hidden="true" />
                    </button>
                    <div class="action-label">Создать QR</div>
                </div>
            </section>

            <hr>

            <section class="filters">
                <div class="chips">
                    <button class="chip active" data-filter="all">Все</button>
                    <button class="chip" data-filter="credit">Поступления</button>
                    <button class="chip" data-filter="debit">Списания</button>
                </div>
                <div class="input-inline search-inline">
                    <input id="searchInput" type="search" placeholder="Поиск по описанию или контрагенту">
                    <!-- <button id="exportBtn" class="btn-icon export-btn" type="button" title="Экспорт в CSV"
                        aria-label="Экспорт">
                        <img src="/static/icons/export.svg" width="18" height="18" alt="" aria-hidden="true" />
                    </button> -->
                </div>
            </section>


            <section class="history card ios-card animate-rise">
                <h3>История операций</h3>
                <ul id="txList" class="tx-list"></ul>
                <div id="emptyState" class="empty-state" hidden>Пока нет операций</div>
            </section>
        </main>
    </div>

    <!-- Modal: Transfer -->
    <div id="transferModal" class="modal">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Перевод</h3>
                <button class="btn-icon" data-close="transferModal">✕</button>
            </div>
            <div class="modal-body">
                <form id="transferForm" class="form">
                    <div class="input-group">
                        <label>Юзернейм получателя</label>
                        <input type="text" name="recipient_username" placeholder="@username" required>
                    </div>
                    <div class="input-group">
                        <label>Сумма</label>
                        <input type="text" name="amount" placeholder="Напр. 499.90" required inputmode="decimal">
                    </div>
                    <div class="input-group">
                        <label>Описание (необязательно)</label>
                        <input type="text" name="description" placeholder="На подарок">
                    </div>
                    <button class="btn btn-primary btn-large" type="submit">Перевести</button>
                </form>
            </div>
        </div>
    </div>


    <!-- Modal: Scan -->
    <div id="scanModal" class="modal">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Оплата по QR</h3>
                <button class="btn-icon" data-close="scanModal">✕</button>
            </div>
            <div class="modal-body">
                <div class="video-wrap">
                    <video id="video" playsinline></video>
                    <canvas id="canvas" class="hidden"></canvas>
                    <div id="scanHint" class="hint">Наведите камеру на QR‑код</div>
                </div>
                <div class="or">или</div>
                <div class="input-inline">
                    <input type="text" id="manualInput" placeholder="PAY:123 или https://...">
                    <button id="manualPayBtn" class="btn btn-secondary" type="button">Оплатить</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Create invoice -->
    <div id="invoiceModal" class="modal">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Новый счёт</h3>
                <button class="btn-icon" data-close="invoiceModal">✕</button>
            </div>
            <div class="modal-body">
                <form id="invoiceForm" class="form">
                    <div class="input-group">
                        <label>Сумма</label>
                        <input type="text" name="amount" placeholder="Напр. 499.90" required inputmode="decimal">
                    </div>
                    <div class="input-group">
                        <label>Описание (необязательно)</label>
                        <input type="text" name="description" placeholder="За кофе">
                    </div>
                    <button class="btn btn-primary btn-large" type="submit">Сгенерировать</button>
                </form>

                <div id="invoiceResult" class="invoice-result" hidden>
                    <div class="qr-wrap">
                        <img id="qrImage" alt="QR для оплаты">
                    </div>
                    <div class="payload-row">
                        <code id="payloadText"></code>
                        <button id="copyPayloadBtn" class="btn btn-ghost" type="button">Копировать</button>
                    </div>
                    <div class="hint">Передайте QR‑код плательщику</div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Modal: Transaction Details -->
    <div id="txDetailModal" class="modal">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Детали операции</h3>
                <button class="btn-icon" data-close="txDetailModal">✕</button>
            </div>
            <div class="modal-body">
                <div id="txDetailContent" class="form">
                    <!-- Content will be injected by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Confirm (custom, replaces window.confirm) -->
    <div id="confirmModal" class="modal" aria-hidden="true">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Подтверждение</h3>
                <button class="btn-icon" data-close="confirmModal">✕</button>
            </div>
            <div class="modal-body">
                <p class="confirm-message"> </p>
                <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
                    <button data-confirm="no" class="btn btn-ghost" type="button">Отменить</button>
                    <button data-confirm="yes" class="btn btn-primary" type="button">Подтвердить</button>
                </div>
            </div>
        </div>
    </div>


    <div id="toastContainer" class="toast-container"></div>

    <script src="/static/js/app.js"></script>
</body>

</html>