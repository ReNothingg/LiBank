<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <title>Mobile Bank ‚Äî –ê–∫–∫–∞—É–Ω—Ç</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- jsQR fallback –¥–ª—è —à–∏—Ä–æ–∫–∏—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ (–µ—Å–ª–∏ –Ω–µ—Ç BarcodeDetector) -->
    <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
</head>

<body data-page="account">
    <div class="app-gradient"></div>
    <div class="safe-area">

        <header class="topbar">
            <div class="brand">Bank</div>
            <div class="topbar-actions">
                <!-- NEW: Profile button -->
                <button class="btn-icon" aria-label="–ü—Ä–æ—Ñ–∏–ª—å" onclick="location.href='/profile'"> ‚öôÔ∏è </button>
                <button id="logoutBtn" class="btn-icon" aria-label="–í—ã—Ö–æ–¥"> ü§ï </button>
            </div>
        </header>

        <main class="content">
            <section class="balance card ios-card animate-rise">
                <div class="balance-label">–ë–∞–ª–∞–Ω—Å</div>
                <div id="balanceValue" class="balance-value">‚Äî</div>
                <div id="fullNameLabel" class="balance-fullname">‚Äî</div>
                <div id="usernameLabel" class="balance-sub">‚Äî</div>
            </section>

            <section class="actions">
                <button id="transferBtn" class="btn btn-primary btn-large">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                <button id="scanBtn" class="btn btn-secondary btn-large">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR</button>
                <button id="createInvoiceBtn" class="btn btn-secondary btn-large">–°–æ–∑–¥–∞—Ç—å QR</button>
            </section>

            <section class="filters">
                <div class="chips">
                    <button class="chip active" data-filter="all">–í—Å–µ</button>
                    <button class="chip" data-filter="credit">–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è</button>
                    <button class="chip" data-filter="debit">–°–ø–∏—Å–∞–Ω–∏—è</button>
                </div>
                <div class="input-inline">
                    <input id="searchInput" type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É">
                    <!-- NEW: Export button -->
                    <button id="exportBtn" class="btn-icon" type="button" title="–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV">‚á©</button>
                </div>
            </section>

            <section class="history card ios-card animate-rise">
                <h3>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
                <ul id="txList" class="tx-list"></ul>
                <div id="emptyState" class="empty-state" hidden>–ü–æ–∫–∞ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>
            </section>
        </main>
    </div>

    <!-- Modal: Transfer -->
    <div id="transferModal" class="modal">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>–ü–µ—Ä–µ–≤–æ–¥</h3>
                <button class="btn-icon" data-close="transferModal">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="transferForm" class="form">
                    <div class="input-group">
                        <label>–Æ–∑–µ—Ä–Ω–µ–π–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                        <input type="text" name="recipient_username" placeholder="@username" required>
                    </div>
                    <div class="input-group">
                        <label>–°—É–º–º–∞</label>
                        <input type="text" name="amount" placeholder="–ù–∞–ø—Ä. 499.90" required inputmode="decimal">
                    </div>
                    <div class="input-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <input type="text" name="description" placeholder="–ù–∞ –ø–æ–¥–∞—Ä–æ–∫">
                    </div>
                    <button class="btn btn-primary btn-large" type="submit">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                </form>
            </div>
        </div>
    </div>


    <!-- Modal: Scan -->
    <div id="scanModal" class="modal">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>–û–ø–ª–∞—Ç–∞ –ø–æ QR</h3>
                <button class="btn-icon" data-close="scanModal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="video-wrap">
                    <video id="video" playsinline></video>
                    <canvas id="canvas" class="hidden"></canvas>
                    <div id="scanHint" class="hint">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR‚Äë–∫–æ–¥</div>
                </div>
                <div class="or">–∏–ª–∏</div>
                <div class="input-inline">
                    <input type="text" id="manualInput" placeholder="PAY:123 –∏–ª–∏ https://...">
                    <button id="manualPayBtn" class="btn btn-secondary" type="button">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Create invoice -->
    <div id="invoiceModal" class="modal">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>–ù–æ–≤—ã–π —Å—á—ë—Ç</h3>
                <button class="btn-icon" data-close="invoiceModal">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="invoiceForm" class="form">
                    <div class="input-group">
                        <label>–°—É–º–º–∞</label>
                        <input type="text" name="amount" placeholder="–ù–∞–ø—Ä. 499.90" required inputmode="decimal">
                    </div>
                    <div class="input-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <input type="text" name="description" placeholder="–ó–∞ –∫–æ—Ñ–µ">
                    </div>
                    <button class="btn btn-primary btn-large" type="submit">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>

                <div id="invoiceResult" class="invoice-result" hidden>
                    <div class="qr-wrap">
                        <img id="qrImage" alt="QR –¥–ª—è –æ–ø–ª–∞—Ç—ã">
                    </div>
                    <div class="payload-row">
                        <code id="payloadText"></code>
                        <button id="copyPayloadBtn" class="btn btn-ghost" type="button">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    <div class="hint">–ü–µ—Ä–µ–¥–∞–π—Ç–µ QR‚Äë–∫–æ–¥ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫—É</div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Modal: Transaction Details -->
    <div id="txDetailModal" class="modal">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>–î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
                <button class="btn-icon" data-close="txDetailModal">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="txDetailContent" class="form">
                    <!-- Content will be injected by JS -->
                </div>
            </div>
        </div>
    </div>


    <div id="toastContainer" class="toast-container"></div>

    <script src="/static/js/app.js"></script>
</body>

</html>